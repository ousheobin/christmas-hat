(function(t){function e(e){for(var n,s,o=e[0],c=e[1],d=e[2],u=0,h=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(h.length)h.shift()();return r.push.apply(r,d||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,o=1;o<a.length;o++){var c=a[o];0!==i[c]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/christmas-hat/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var d=0;d<o.length;d++)e(o[d]);var l=c;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},1:function(t,e){},2:function(t,e){},2395:function(t,e,a){},3:function(t,e){},"4e93":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},r=[],s=(a("7c55"),a("2877")),o={},c=Object(s["a"])(o,i,r,!1,null,null,null),d=c.exports,l=a("9483");Object(l["a"])("".concat("/christmas-hat/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});a("d3b7");var u=a("8c4f");a("bb51");n["a"].use(u["a"]);var h=[{path:"/",name:"Home",component:function(){return Promise.resolve().then(a.bind(null,"bb51"))}}],f=new u["a"]({mode:"hash",base:"/christmas-hat/",routes:h}),v=f;n["a"].config.productionTip=!1,new n["a"]({router:v,render:function(t){return t(d)}}).$mount("#app")},"7c55":function(t,e,a){"use strict";a("2395")},"8d91":function(t,e,a){},bb51:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home"},[a("h1",[t._v("Merry Christmas")]),a("p",[t._v("试下看 AI 能不能给你的图片戴上圣诞帽")]),a("picView"),t._m(0)],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"statement"},[a("p",[t._v("本功能采用开源技术 Tensorflow.js 实现")]),a("p",[t._v("我们不会存储任何图片数据")]),a("p",[t._v("© Steve's 2020")])])}],r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pic-view"},[t.showLoading?a("div",{staticClass:"loading-mask"},[t._m(0),a("p",{staticClass:"loading-hints"},[t._v(t._s(t.loadingHints))])]):t._e(),a("input",{ref:"imgInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileChange}}),t.showCanvas?t._e():a("img",{staticClass:"preview-img",attrs:{src:t.dataURL}}),t.showCanvas?a("canvas",{ref:"drawingCanvas",staticClass:"preview-img"}):t._e(),a("button",{staticClass:"btn btn-select-pic",on:{click:t.selectFile}},[t._v("选择图片")]),a("button",{staticClass:"btn btn-save-pic",on:{click:t.save}},[t._v("保存图片")])])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sk-chase"},[a("div",{staticClass:"sk-chase-dot"}),a("div",{staticClass:"sk-chase-dot"}),a("div",{staticClass:"sk-chase-dot"}),a("div",{staticClass:"sk-chase-dot"}),a("div",{staticClass:"sk-chase-dot"}),a("div",{staticClass:"sk-chase-dot"})])}],o=(a("d3b7"),a("3ca3"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e7"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("ddb0"),a("2b3d"),a("96cf"),a("1da1")),c=a("fa11"),d=a("0ad6"),l=a("1a1c"),u="./model";l["BlazeFaceModel"];function h(){return f.apply(this,arguments)}function f(){return f=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,a,n,i,r,s,o,c,h,f,v,g,p,w=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=w.length>0&&void 0!==w[0]?w[0]:{},a=e.maxFaces,n=void 0===a?10:a,i=e.inputWidth,r=void 0===i?128:i,s=e.inputHeight,o=void 0===s?128:s,c=e.iouThreshold,h=void 0===c?.3:c,f=e.scoreThreshold,v=void 0===f?.75:f,t.next=3,d["a"](u,{fromTFHub:!0});case 3:return g=t.sent,p=new l["BlazeFaceModel"](g,r,o,n,h,v),t.abrupt("return",p);case 6:case"end":return t.stop()}}),t)}))),f.apply(this,arguments)}a("ee7d");var v=window.URL||window.webkitURL,g=null,p={name:"PicView",mounted:function(){this.$refs.drawingCanvas||alert("哎呀，你的浏览器不支持这个功能哦,要不换个浏览器？"),this.handlePic()},methods:{handleFileChange:function(){var t=this.$refs.imgInput;t&&t.files&&t.files.length>0&&(this.$data.filePath=v.createObjectURL(t.files[0]),this.$data.showLoading=!0,this.$data.showCanvas=!0,setTimeout(this.waitCanvas,500))},waitCanvas:function(){this.$refs.drawingCanvas?this.handlePic():setTimeout(this.waitCanvas,500)},selectFile:function(){var t=this.$refs.imgInput;t.click()},save:function(){this.$refs.drawingCanvas&&(this.$data.dataURL=this.$refs.drawingCanvas.toDataURL("img/jpeg"),this.$data.showCanvas=!1),alert("长按图片就可以保存啦~")},handlePic:function(){var t=this,e=this.$refs.drawingCanvas.getContext("2d");this.$data.canvasCtx=e;var a=this.$refs.drawingCanvas;e.clearRect(0,0,a.width,a.height),this.drawImg(e,(function(){for(var n=e.getImageData(0,0,a.width,a.height),i=new Uint8Array(n.width*n.height*3),r=0,s=0;s<n.data.length;s+=4)i[r]=n.data[s],i[r+1]=n.data[s+1],i[r+2]=n.data[s+2],r+=3;var o=c["tensor3d"](i,[n.height,n.width,3]);t.doPredict(o)}))},drawImg:function(t,e){var a=this.$refs.drawingCanvas,n=new Image;n.src=this.$data.filePath,n.onload=function(){var i=a.width,r=Math.round(a.width/n.width*n.height);a.height=r,t.drawImage(n,0,0,i,r),e&&e()}},doPredict:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var n,i,r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(g){a.next=5;break}return a.next=3,h();case 3:g=a.sent,e.$data.loadingHints="模型正在努力地研究，稍等...";case 5:return n=!1,i=!1,r=!0,a.next=10,g.estimateFaces(t,n,i,r);case 10:s=a.sent,e.drawHat(s);case 12:case"end":return a.stop()}}),a)})))()},drawHat:function(t){var e=this,a=this.$data.canvasCtx;this.$refs.drawingCanvas;this.drawImg(a,(function(){var n=[0,0],i=[0,0],r=[0,0];if(0==t.length)return e.$data.showLoading=!1,e.$data.dataURL=e.$refs.drawingCanvas.toDataURL("img/jpeg"),void(e.$data.showCanvas=!1);for(var s=function(s){var o=t[s].landmarks;n=o[0],i=o[1],r=o[2];e.distanceBtwPoints(n,i);var c=e.slope(n,i),d=n[1]-n[0]*c,l=-1/c,u=r[1]-r[0]*l,h=(d-u)/(l-c),f=l*h+u,v=h-(r[0]-h),g=f-(r[1]-f),p=t[s].topLeft,w=t[s].bottomRight,m=(w[0],p[0],w[1],p[1],new Image);m.src="img/common/hat.png",m.onload=function(){var n=1.2*Math.abs(w[0]-p[0]),i=Math.round(n/m.width*m.height);a.drawImage(m,v-.75*n,g-1.1*i,n,i),s==t.length-1&&(e.$data.showLoading=!1,e.$data.dataURL=e.$refs.drawingCanvas.toDataURL("img/jpeg"),e.$data.showCanvas=!1)}},o=0;o<t.length;o++)s(o)}))},slope:function(t,e){return t[1]==e[1]?0:(t[1]-e[1])/(t[0]-e[0])},distanceBtwPoints:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}},data:function(){return{showLoading:!0,dataURL:"",showCanvas:!0,loadingHints:"AI 模型正在加载 ing ...",filePath:"img/common/cat.jpg",imgElement:null,canvasCtx:null,showPreviewImg:!0}}},w=p,m=(a("ef9a"),a("2877")),b=Object(m["a"])(w,r,s,!1,null,null,null),C=b.exports,$={name:"Home",components:{picView:C}},_=$,y=(a("de16"),Object(m["a"])(_,n,i,!1,null,null,null));e["default"]=y.exports},de16:function(t,e,a){"use strict";a("8d91")},ef9a:function(t,e,a){"use strict";a("4e93")}});