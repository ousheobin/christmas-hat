(function(t){function e(e){for(var a,s,o=e[0],c=e[1],d=e[2],u=0,h=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);l&&l(e);while(h.length)h.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={app:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/christmas/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var d=0;d<o.length;d++)e(o[d]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},2:function(t,e){},2395:function(t,e,n){},3:function(t,e){},"4e93":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},r=[],s=(n("7c55"),n("2877")),o={},c=Object(s["a"])(o,i,r,!1,null,null,null),d=c.exports,l=n("9483");Object(l["a"])("".concat("/christmas/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});n("d3b7");var u=n("8c4f");n("bb51");a["a"].use(u["a"]);var h=[{path:"/",name:"Home",component:function(){return Promise.resolve().then(n.bind(null,"bb51"))}}],f=new u["a"]({mode:"hash",base:"/christmas/",routes:h}),v=f;a["a"].config.productionTip=!1,new a["a"]({router:v,render:function(t){return t(d)}}).$mount("#app")},"7c55":function(t,e,n){"use strict";n("2395")},"8d91":function(t,e,n){},bb51:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("h1",[t._v("Merry Christmas")]),n("p",[t._v("试下看 AI 能不能给你的图片戴上圣诞帽")]),n("picView"),t._m(0)],1)},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"statement"},[n("p",[t._v("本功能采用开源技术 Tensorflow.js 实现")]),n("p",[t._v("我们不会存储任何图片数据")]),n("p",[t._v("© Steve's 2020")])])}],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pic-view"},[t.showLoading?n("div",{staticClass:"loading-mask"},[t._m(0),n("p",{staticClass:"loading-hints"},[t._v(t._s(t.loadingHints))])]):t._e(),n("input",{ref:"imgInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileChange}}),t.showCanvas?t._e():n("img",{staticClass:"preview-img",attrs:{src:t.dataURL}}),t.showCanvas?n("canvas",{ref:"drawingCanvas",staticClass:"preview-img"}):t._e(),n("button",{staticClass:"btn btn-select-pic",on:{click:t.selectFile}},[t._v("选择图片")]),n("button",{staticClass:"btn btn-save-pic",on:{click:t.save}},[t._v("保存图片")])])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sk-chase"},[n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"}),n("div",{staticClass:"sk-chase-dot"})])}],o=(n("d3b7"),n("3ca3"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e7"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d"),n("96cf"),n("1da1")),c=n("fa11"),d=n("0ad6"),l=n("1a1c"),u="./model";l["BlazeFaceModel"];function h(){return f.apply(this,arguments)}function f(){return f=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n,a,i,r,s,o,c,h,f,v,g,p,w=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=w.length>0&&void 0!==w[0]?w[0]:{},n=e.maxFaces,a=void 0===n?10:n,i=e.inputWidth,r=void 0===i?128:i,s=e.inputHeight,o=void 0===s?128:s,c=e.iouThreshold,h=void 0===c?.3:c,f=e.scoreThreshold,v=void 0===f?.75:f,t.next=3,d["a"](u,{fromTFHub:!0});case 3:return g=t.sent,p=new l["BlazeFaceModel"](g,r,o,a,h,v),t.abrupt("return",p);case 6:case"end":return t.stop()}}),t)}))),f.apply(this,arguments)}n("ee7d");var v=window.URL||window.webkitURL,g=null,p={name:"PicView",mounted:function(){this.$refs.drawingCanvas||alert("哎呀，你的浏览器不支持这个功能哦,要不换个浏览器？"),this.handlePic()},methods:{handleFileChange:function(){var t=this.$refs.imgInput;t&&t.files&&t.files.length>0&&(this.$data.filePath=v.createObjectURL(t.files[0]),this.$data.showLoading=!0,this.$data.showCanvas=!0,setTimeout(this.waitCanvas,500))},waitCanvas:function(){this.$refs.drawingCanvas?this.handlePic():setTimeout(this.waitCanvas,500)},selectFile:function(){var t=this.$refs.imgInput;t.click()},save:function(){this.$refs.drawingCanvas&&(this.$data.dataURL=this.$refs.drawingCanvas.toDataURL("img/jpeg"),this.$data.showCanvas=!1),alert("长按图片就可以保存啦~")},handlePic:function(){var t=this,e=this.$refs.drawingCanvas.getContext("2d");this.$data.canvasCtx=e;var n=this.$refs.drawingCanvas;e.clearRect(0,0,n.width,n.height),this.drawImg(e,(function(){for(var a=e.getImageData(0,0,n.width,n.height),i=new Uint8Array(a.width*a.height*3),r=0,s=0;s<a.data.length;s+=4)i[r]=a.data[s],i[r+1]=a.data[s+1],i[r+2]=a.data[s+2],r+=3;var o=c["tensor3d"](i,[a.height,a.width,3]);t.doPredict(o)}))},drawImg:function(t,e){var n=this.$refs.drawingCanvas,a=new Image;a.src=this.$data.filePath,a.onload=function(){var i=n.width,r=Math.round(n.width/a.width*a.height);n.height=r,t.drawImage(a,0,0,i,r),e&&e()}},doPredict:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,i,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(g){n.next=5;break}return n.next=3,h();case 3:g=n.sent,e.$data.loadingHints="模型正在努力地研究，稍等...";case 5:return a=!1,i=!1,r=!0,n.next=10,g.estimateFaces(t,a,i,r);case 10:s=n.sent,e.drawHat(s);case 12:case"end":return n.stop()}}),n)})))()},drawHat:function(t){var e=this,n=this.$data.canvasCtx;this.$refs.drawingCanvas;this.drawImg(n,(function(){var a=[0,0],i=[0,0],r=[0,0];if(0==t.length)return e.$data.showLoading=!1,e.$data.dataURL=e.$refs.drawingCanvas.toDataURL("img/jpeg"),void(e.$data.showCanvas=!1);for(var s=function(s){var o=t[s].landmarks;a=o[0],i=o[1],r=o[2];e.distanceBtwPoints(a,i);var c=e.slope(a,i),d=a[1]-a[0]*c,l=-1/c,u=r[1]-r[0]*l,h=(d-u)/(l-c),f=l*h+u,v=h-(r[0]-h),g=f-(r[1]-f),p=t[s].topLeft,w=t[s].bottomRight,m=(w[0],p[0],w[1],p[1],new Image);m.src="img/common/hat.png",m.onload=function(){var a=1.2*Math.abs(w[0]-p[0]),i=Math.round(a/m.width*m.height);n.drawImage(m,v-.75*a,g-1.1*i,a,i),s==t.length-1&&(e.$data.showLoading=!1,e.$data.dataURL=e.$refs.drawingCanvas.toDataURL("img/jpeg"),e.$data.showCanvas=!1)}},o=0;o<t.length;o++)s(o)}))},slope:function(t,e){return t[1]==e[1]?0:(t[1]-e[1])/(t[0]-e[0])},distanceBtwPoints:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}},data:function(){return{showLoading:!0,dataURL:"",showCanvas:!0,loadingHints:"AI 模型正在加载 ing ...",filePath:"img/common/cat.jpg",imgElement:null,canvasCtx:null,showPreviewImg:!0}}},w=p,m=(n("ef9a"),n("2877")),b=Object(m["a"])(w,r,s,!1,null,null,null),C=b.exports,$={name:"Home",components:{picView:C}},_=$,y=(n("de16"),Object(m["a"])(_,a,i,!1,null,null,null));e["default"]=y.exports},de16:function(t,e,n){"use strict";n("8d91")},ef9a:function(t,e,n){"use strict";n("4e93")}});